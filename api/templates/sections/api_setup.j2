<div class="api-config-section">
    <div class="api-credentials-section">
        <h3>API Credentials</h3>
        <p>Use these credentials to authenticate with the API endpoints. Your API secret should be kept secure.</p>
        <api-config jsum></api-config>
    </div>
    
    <div class="api-reference-section">
        <h3>API Reference</h3>
        <p>Below are the available classifiers and extractors with their IDs for use with the API endpoints.</p>
        <api-reference jsum></api-reference>
    </div>
    
    <div class="api-documentation">
        <h3>API Documentation</h3>
        <p>Use the following endpoints with HTTP Basic Authentication using your API key as username and API secret as password:</p>
        
        <div class="endpoint-docs">
            <h4>File Upload</h4>
            <div class="endpoint">
                <code>POST /service/file</code>
                <p>Upload a document file for processing. Returns file ID.</p>
                <pre>curl -X POST -u "your-api-key:your-api-secret" \
  -F "file=@document.pdf" \
  {{request.url_root}}service/file</pre>
            </div>

            <h4>Markdown Upload</h4>
            <div class="endpoint">
                <code>PUT /service/file/markdown</code>
                <p>Upload Markdown content as a document. The first line of the content is used as the filename.</p>

                <h5>Request Parameters:</h5>
                <ul>
                    <li><strong>content</strong> (required): The Markdown content to upload</li>
                </ul>

                <h5>Usage Notes:</h5>
                <ul>
                    <li>First line becomes the filename (markdown formatting like # is stripped)</li>
                    <li>Filename is automatically sanitized and given .md extension</li>
                    <li>Content is processed through the same extraction pipeline as file uploads</li>
                    <li>Returns document ID and generated filename</li>
                    <li>Compatible with SmolPageBot Chrome extension for easy web page capture</li>
                </ul>

                <h5>Example Request:</h5>
                <pre>curl -X PUT -u "your-api-key:your-api-secret" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "# My Document Title\n\nThis is the content of my markdown document.\n\n## Section 1\n\nSome more content here."
  }' \
  {{request.url_root}}service/file/markdown</pre>

                <h5>Example Response:</h5>
                <pre>{
  "id": 124,
  "filename": "My-Document-Title.md"
}</pre>
            </div>
            
            <h4>Classification</h4>
            <div class="endpoint">
                <code>GET /service/classifier/{classifier_id}/{file_id}</code>
                <p>Classify a document using the specified classifier.</p>
                <pre>curl -u "your-api-key:your-api-secret" \
  {{request.url_root}}service/classifier/1/123</pre>
            </div>
            
            <h4>Extraction</h4>
            <div class="endpoint">
                <code>POST /service/extractor</code>
                <p>Extract information from a document using the specified extractor. This operation runs asynchronously in the background.</p>
                
                <h5>Request Parameters:</h5>
                <ul>
                    <li><strong>extractor_id</strong> (required): The ID of the extractor to use</li>
                    <li><strong>file_id</strong> (required): The ID of the uploaded document file</li>
                    <li><strong>web_hook</strong> (required): URL where extraction results will be sent via POST</li>
                    <li><strong>csrf_token</strong> (optional): CSRF protection token for webhook validation</li>
                </ul>
                
                <h5>Webhook Details:</h5>
                <p>When extraction completes, results are sent to your webhook URL via POST request:</p>
                <ul>
                    <li>The webhook receives the extracted data as JSON</li>
                    <li>Include a CSRF token to verify webhook authenticity</li>
                    <li>Ensure your webhook endpoint can handle POST requests</li>
                    <li>Webhook should return 200 status for successful receipt</li>
                </ul>
                
                <h5>CSRF Token Usage:</h5>
                <p>The CSRF token provides security verification for webhook calls:</p>
                <ul>
                    <li>Generate a unique token for each extraction request</li>
                    <li>Store the token to validate incoming webhook calls</li>
                    <li>The system will include this token in the webhook payload</li>
                    <li>Verify the token matches before processing webhook data</li>
                </ul>

                <h5>Marked PDF Generation:</h5>
                <p>When extraction finds data with citations, the system automatically creates a marked-up PDF:</p>
                <ul>
                    <li>Citations from extracted fields are highlighted in yellow</li>
                    <li>Non-PDF documents are automatically converted to PDF first</li>
                    <li>Each extractor creates its own marked version</li>
                    <li>Webhook payload includes <code>marked_pdf_available</code> flag</li>
                    <li>Use marked PDF endpoints to download highlighted versions</li>
                </ul>

                <h5>Example Request:</h5>
                <pre>curl -X POST -u "your-api-key:your-api-secret" \
  -H "Content-Type: application/json" \
  -d '{
    "extractor_id": 1, 
    "file_id": 123, 
    "web_hook": "https://your-domain.com/api/extraction-webhook", 
    "csrf_token": "abc123-secure-token-xyz789"
  }' \
  {{request.url_root}}service/extractor</pre>
  
                <h5>Example Webhook Payload:</h5>
                <p>Your webhook will receive a POST request similar to:</p>
                <pre>{
  "result": {
    "confidence": 1,
    "found": true,
    "explanation": "Explanation ...",
    "extracted_data": {
      "field_1": {
        "value": "value 1",
        "citation": ["Quote from document supporting field_1"]
      },
      "field_2": {
        "value": "value 2", 
        "citation": ["Quote 1", "Quote 2"]
      }
    }
  },
  "file_name": "document.pdf",
  "document_id": 123,
  "csrf_token": "abc123-secure-token-xyz789",
  "marked_pdf_available": true,
  "marked_pdf_path": "/path/to/document.marked.1.pdf"
}</pre>
            </div>
            
            <h4>Marked PDF Download</h4>
            <div class="endpoint">
                <code>GET /service/marked-pdf/{extractor_id}/{file_id}</code>
                <p>Download a marked-up PDF with highlighted citations from an extraction. The PDF contains visual highlights showing where extracted information was found in the original document.</p>
                
                <h5>Usage:</h5>
                <ul>
                    <li>Only available after successful extraction with citations</li>
                    <li>Automatically converts non-PDF documents to PDF before marking</li>
                    <li>Returns 404 if no marked version exists</li>
                    <li>Each extractor creates its own marked version</li>
                </ul>
                
                <h5>Example:</h5>
                <pre>curl -u "your-api-key:your-api-secret" \
  --output "marked_document.pdf" \
  {{request.url_root}}service/marked-pdf/1/123</pre>
            </div>
            
            <h4>Marked PDF Status</h4>
            <div class="endpoint">
                <code>GET /service/marked-pdf-status/{file_id}</code>
                <p>Check which marked PDF versions are available for a document across all your extractors.</p>
                
                <h5>Response Format:</h5>
                <pre>{
  "file_id": 123,
  "pdf_available": true,
  "marked_versions": [
    {
      "extractor_id": 1,
      "extractor_name": "Invoice Extractor",
      "file_size": 245760
    },
    {
      "extractor_id": 2, 
      "extractor_name": "Contract Extractor",
      "file_size": 238950
    }
  ],
  "total_marked_versions": 2
}</pre>
                
                <h5>Example:</h5>
                <pre>curl -u "your-api-key:your-api-secret" \
  {{request.url_root}}service/marked-pdf-status/123</pre>
            </div>
            
            <h4>File Cleanup</h4>
            <div class="endpoint">
                <code>DELETE /service/file/{file_id}</code>
                <p>Remove an uploaded file from the system. This also deletes any associated marked PDF versions.</p>
                <pre>curl -X DELETE -u "your-api-key:your-api-secret" \
  {{request.url_root}}service/file/123</pre>
            </div>
        </div>
    </div>
</div>